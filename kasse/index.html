<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>OrgaMon Kasse Rev 1.026</title>
<style type="text/css">
<!--
 button {font-family:monospace; font-size:15pt; font-weight:bolder;}
 body {font-family:monospace; font-size:12pt; font-weight:bold;}
 .lst {font:12pt monospace; font-weight:bolder; vertical-align:bottom;}
 .sum {font:12pt monospace; font-weight:bolder; vertical-align:bottom; text-align:right; }
}
-->
</style>
<script type="text/javascript">
var 
 // Request - Object
 xmlhttp = new XMLHttpRequest();

 // Sound Objekte 
 snd_beep = new Audio("beep.mp3");  
 snd_bleep = new Audio("bleep.mp3");  
 snd_boop = new Audio("boop.mp3");
 
 // "zurück" Objekte, Löschhistorie
 bs_Faktor = new Array();  // bestimmt wieviele Zeilen bei einem "bs" gelöscht werden müssen
 bs_Value = new Array(); // bestimmt den Preis, der von der Gesamtsumme abgezogen werden muss
 
 // Kontext
 sortimentIndex = 0;
 mulFaktor = 1;
 
 /*  
 // next 4 Lines are Generated by OrgaMon-OLAP "Kasse-JavaScript.OLAP.txt"
ERZEUGT;KOMMENTAR
2015-05-05 15:28:18.6860;*/
Code=new Array (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 32, 38, 39, 40, 41, 42, 43, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 81, 82, 83, 84, 89, 90, 91, 92, 93, 94, 95, 97, 99, 100, 104, 105, 106, 107, 108, 109, 110, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 129, 130, 131, 133, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 160, 161, 162, 163, 164, 165, 166, 167, 170, 171, 172, 173, 174, 175, 176, 177, 180, 181, 182, 183, 184, 185, 186, 187, 190, 191, 192, 193, 194, 195, 196, 197, 200, 201, 202, 203, 123456, 123457);
Titel=new Array ('Impfung Katze', 'Impfung Katze', 'Impfung Hund', 'Impfung Hund', 'Impfungen Kaninchen', 'Allgemeine Untersuchung Hund', 'Allgemeine Untersuchung Katze', 'Allgemeine Untersuchung Heimtier', 'Nachkontrolle Hund', 'Nachkontrolle Katze', 'Nachkontrolle Heimtier', 'Injektion', 'Krallen kürzen Hund/Katze', 'Krallen kürzen Heimtier', 'Ohrtoilette*erste', 'Ohrtoilette*folgende', 'Advantage 40mg Hund 1 Pip. < 4kg', 'Advantage 100 Hund 1 Pip. 4-10kg', 'Advantage 250 Hund 1 Pip. 10-25kg', 'Advantage 400 Hund 1 Pip. >25kg', 'Advantage 40 Katze 1 Pip. < 4kg', 'Advantage 80 Katze 1 Pip. > 4kg', 'Banminth Katze 3g', 'Drontal Flavour plus XL', 'Drontal Flavour Plus 1Tabl.', 'Drontal Katze 1Tabl.', 'Droncit 1Tabl.', 'Droncit Spot on 1 Pip.', 'Exspot 1Tube nur f. Hunde', 'Prazifen-Kombi 1Blister', 'Vermis Ex 1Tabl.', 'TSO 80 / 1Tabl.', 'Cefaseptin forte 1Tabl.', 'Cleorobe Kapseln 300 mg', 'Cleorobe Kapseln 25mg', 'Cleorobe Kapseln 75mg', 'Cleorobe Kapseln 150mg', 'Caniphedrin 50 / 1 Str.', 'Contralac 2.0mg   16 Tabl.', 'Contralac 0.5mg   16Tabl.', 'Banminth Hund 24g', 'Dimazon 40mg 1Tabl', 'Enacard 1mg', 'Enacard 2,5mg', 'Enacard 5mg', 'Enacard 10mg', 'Benakor 5mg / 1 Str.', 'Benakor 20mg / 1 Str.', 'Flubenol P 1Tube', 'Panolog 15 ml', 'Incurin 30 Tab.', 'Karsivan 50 60Tabl.', 'Karsivan 100 60Tabl.', 'Metacam 10ml 1.5mg/ml', 'Metacam 32ml 1.5mg/ml', 'Metacam 0.5mg Suspension Katze 15ml', 'Phen-Pred 1Tabl.', 'Prurivet 100 ml', 'Rimadyl 50mg  1Tabl.', 'Rimadyl 100mg 1Tabl.', 'Vitagel Augengel 10g', 'Vetmedin 1.25mg  100 Kaps.', 'Vetmedin 2.5mg', 'Vetmedin 5mg', 'Bezo-Pet 70g', 'Bezo-Pet 120g', 'Biosel-HK', 'Bird Bene Bac 1Tube', 'Canikur 12 Tabl.', 'Calo-Pet  120 g', 'Canosan Pellets 1000g', 'Relaxan 30Tabl.', 'Uro-Pet 120g', 'Viacutan Plus Kapseln', 'VMP Pfizer Tabl. 50 St.', 'Ciloxan Augentropfen 5 ml', 'Gentamicin AT', 'Gentamicin AS', 'Floxal AT', 'Floxal AS', 'Dispadex comp. Augentropfen', 'Corti Biciron N 2,5 g', 'Aurizon 10ml', 'Epi-Otic 60ml', 'Epi-Otic 125ml', 'Surolan 15ml', 'Röntgenaufnahme', 'Röntgenaufnahme*folgende', 'Blutprobenentnahme', 'Injektion (postoperative Schmerzbehandlung)', 'Kombinationsinjektion', 'Hormoninjektion', 'Regepithel AS 5g (Alcon)', 'Canikur  / 1 Streifen', 'Injektionsnarkose Hund', 'Analbeutel manuell entleert', 'Beratung', 'Behandlung Kater', 'Behandlung Katze', 'Entwurmung / Injektion', 'Impfungen Hund', 'Impfungen Katze', 'Impfung Kaninchen (RHD)', 'Impfung Kaninchen (Myxo)', 'Ampitab 10 ml', 'Amoxiclav 40/10 / 1Tabl.', 'Amoxiclav 200/50 1Tabl.', 'Bactisel-HK', 'Galastop 3ml', 'Galastop 7ml', 'Galastop 15ml', 'Scalibor Halsband klein', 'Scalibor Halsband groß', 'Exspot 1ml OP', 'Stronghold 60mg 1Tube Hund', 'Stronghold 120mg 1Tube Hund', 'Stronghold 240mg 1Tube Hund', 'Korvimin ZVT  200g', 'Chloramphenicol-Pumpspray', 'Otomax Ohrentropfen 14ml', 'Otomax Ohrentropfen 34ml', 'Stronghold 30mg 1Tube Hund', 'Stronghold 15mg 1 Tube Hund/Katze', 'Stronghold 45mg 1Tube Katze', 'Profender Spot on 2.5-5kg', 'Profender Spot on 5-8kg', 'Profender Spot on 0.5-2.5kg', 'Penochron 50ml', 'Carprotab 50 1Tabl.', 'Carprotab 100 1Tabl.', 'Forthyron 200 / 1 Streifen', 'Forthyron 400 / 1 Streifen', 'Vetoryl 10mg 1Tabl.', 'Vetoryl 30mg 1Tabl.', 'DermaSterol 50ml', 'DermaSterol 125ml', 'Suprelorinchip', 'Bepanthen ANS 5g', 'Frontline Hund S OP', 'Frontline Hund M OP', 'Frontline Hund L OP', 'Frontline Katze OP', 'Frontline Combo Hund S OP', 'Frontline Combo Hund M OP', 'Frontline Combo Hund L OP', 'Frontline Combo Katze OP', 'Frontline Spot on H 10', 'Frontline Spot on H 20', 'Frontline Spot on H 40', 'Frontline Spot On K', 'Frontline Combo Hund S', 'Frontline Combo Hund M', 'Frontline Combo Hund L', 'Frontline Combo Katze', 'Milbemax Katze ab 0,5kg', 'Milbemax Katze ab 0,5kg 1/2 Tabl.', 'Milbemax Katze ab 2kg', 'Milbemax Katze ab 2kg 1/2 Tabl.', 'Milbemax Hund ab 0,5kg', 'Milbemax Hund ab 0,5kg 1/2 Tabl.', 'Milbemax Hund ab 5kg', 'Milbemax Hund ab 5kg 1/2 Tabl.', 'Enrotab 15mg', 'Enrotab 50mg', 'Enrotab 150', 'Marbocyl 80 1Tabl.', 'RC Dog VD Hypoallergenic Moderate Calorie [1 Originalpackung 7 Kilogramm]', 'Avibac Cleaner [1 Originalpackung 1000 Milliliter]');
Preis=new Array (2700, 3300, 3000, 4200, 1600, 1432, 954, 1022, 1158, 819, 819, 650, 681, 545, 1022, 681, 851, 955, 1044, 1366, 851, 928, 776, 1342, 479, 668, 602, 655, 791, 552, 124, 21, 85, 275, 47, 114, 180, 210, 2774, 1465, 1006, 43, 4758, 5240, 5701, 7403, 814, 1420, 1111, 1981, 1665, 2300, 4010, 1196, 2569, 1637, 28, 1929, 49, 90, 846, 3301, 4288, 5127, 970, 1359, 835, 341, 1409, 1081, 5953, 999, 1509, 1290, 2075, 1853, 1263, 1177, 1579, 1579, 1493, 1369, 1382, 925, 1388, 1787, 3407, 2044, 681, 800, 1000, 1200, 1215, 470, 3000, 681, 749, 5000, 7500, 800, 8200, 5800, 900, 900, 1549, 42, 104, 612, 1382, 2166, 3709, 3407, 4236, 3368, 1429, 1691, 2244, 2248, 1271, 1549, 2723, 1174, 1039, 1174, 1190, 1377, 961, 470, 36, 66, 162, 250, 160, 208, 1296, 2441, 6400, 355, 3631, 4076, 4871, 3206, 3914, 4463, 5269, 3471, 879, 992, 1196, 747, 952, 1086, 1329, 826, 381, 191, 1038, 519, 333, 167, 1000, 500, 61, 99, 245, 515, 5119, 2365);
Sortiment=new Array ('Impfungen', 'tierärztliche Leistungen', 'Parasitaria', 'Antibiotika', 'Pharmaka', 'Fütterung', 'Augentropfen', 'Ohrentropfen', 'SONSTIGES', 'Fremdlabor');/*
 */
 
function showSortiment () {
  var i = sortimentIndex + 1;
  document.forms.Kasse.Sortiment.value = "S" + i + ":" + Sortiment[sortimentIndex];
}

function disableForm(state){
 var elements = document.forms.Kasse.elements;
 for (var i = 0, len = elements.length; i < len; ++i) {
  if (elements[i].type=="button") {
   if (elements[i].name!=="") {
    if (elements[i].name!=="storno") {
     elements[i].disabled = state;
    }
   }	
  }
 }
}
 
function a (z) {
  
  snd_beep.play();
  
  // Farbe erste mal (wieder) "normal"
  document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";
  // Sortiment initialisieren, wenn nicht schon belegt
  if (document.forms.Kasse.Sortiment.value==="") {
    showSortiment ();  
  }
  
  // Eingabe einfach dazu
  document.forms.Kasse.Eingabe.value += z; 
}
 
function r_add (z) {

    // eine Zeile hinzufügen
    document.forms.Kasse.Rechnung.value += z + '\n';
    // das Ende der textarea sichtbar machen!
    document.forms.Kasse.Rechnung.scrollTop = document.forms.Kasse.Rechnung.scrollHeight;
}
  
function r_plus (z) {
   
  var betrag_cent = 0;
  
  if (z=="") {
    if (mulFaktor==1) {
      betrag_cent = Number(document.forms.Kasse.Einzel.value);
	  if (betrag_cent!=0) {
        snd_beep.play();
        r_add('Rep');
	    document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;
	    bs_Faktor.push(1);
	    bs_Value.push(betrag_cent);
      } else {
    	// einen leeren Betrag kann man nicht repetieren
        snd_boop.play();
	  }
	} else { 
      // Rep ist mit Faktor nicht kombinierbar
      snd_boop.play();
    }
	
  } else {
    var kommaPos = z.indexOf(",");
    if (kommaPos!==-1) {
      // direkte Preiseingabe  
      r_add(z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	  var v = z + "00";
	  v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
      document.forms.Kasse.Einzel.value = v;
	  betrag_cent = Number(v * mulFaktor);
	  document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;

      bs_Faktor.push(mulFaktor);
      bs_Value.push(betrag_cent);

      // reset Mul Faktor
      mulFaktor = 1;

      // das Eingabefeld leeren
	  document.forms.Kasse.Eingabe.value = '';
  
    } else {

      var Suchbegriff = Number(z);
      for (var i = 0; i < Code.length; i++) {
        if (Suchbegriff==Code[i]) {

          // Erfolg
          snd_bleep.play();    
	 
	      // den ermittelten Einzel-Preis anzeigen
          document.forms.Kasse.Einzel.value = Preis[i];	
	
	      // den ermittelnten Preis zu Saldo hinzufügen
	      betrag_cent = Number(Preis[i] * mulFaktor);
	      document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;

	      bs_Faktor.push(mulFaktor);
	      bs_Value.push(betrag_cent);

	      mulFaktor = 1;
     
          // auf den Rechnungsbeleg ausgeben
          r_add(z + ':' + Titel[i]);
	
          // das Eingabefeld leeren
	      document.forms.Kasse.Eingabe.value = '';
	
          return false;
        }
      }
      // Code nicht gefunden
      snd_boop.play();
      document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
    }
  }
}
 
function r_minus (z) {
  
  var kommaPos = z.indexOf(",");
  if (kommaPos!==-1) {

    snd_beep.play();
    // direkte Preiseingabe  
    r_add('-' + z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	var v = z + "00";
	v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
    document.forms.Kasse.Einzel.value = -v;	
	document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - Number(v);
    // das Eingabefeld leeren
	document.forms.Kasse.Eingabe.value = '';
  }
}

function r_mul (z) {
  if (mulFaktor===1) {
   if (z!=="") {
      var kommaPos = z.indexOf(",");
      if (kommaPos!==-1) {
        var zz = z.substring(0, kommaPos) + '.' + z.substring(kommaPos + 1) ;
  	    mulFaktor = Number(zz);
      } 
      else { 
	    mulFaktor = Number(z);
      }
      if (isNaN(mulFaktor)) {
        snd_boop.play();
        mulFaktor = 1;
      } else {
        r_add(z + " mal ...");
        snd_beep.play();

	    bs_Faktor.push(mulFaktor);
	    bs_Value.push(0);
      }
      // das Eingabefeld leeren
      document.forms.Kasse.Eingabe.value = '';
    }
  } else {
    // ein anderer Faktor ist schon aktiv
    snd_boop.play();
  }
}
 
function reset_kasse () {

  disableForm(false);
  var len = document.forms.Kasse.Rechnung.value.length;
  sortimentIndex = 0;
  mulFaktor = 1;
  bs_Faktor = [];
  bs_Value = [];
  document.forms.Kasse.Eingabe.value = "";
  document.forms.Kasse.Rechnung.value = "";
  showSortiment ();
  
  document.forms.Kasse.Einzel.value = "";
  document.forms.Kasse.Summe.value = "";
  if (len==0) {
   location.reload(true);
  }
  
  return false;
}
  
function bs () {

    var len = document.forms.Kasse.Eingabe.value.length;
	var sm = "";
	 
    if (len>0) {
	   snd_beep.play();

     document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";
     document.forms.Kasse.Eingabe.value = document.forms.Kasse.Eingabe.value.substring(0,len-1);
	}
	else {
     len = document.forms.Kasse.Rechnung.value.length;
	 if (len>0) {
   snd_beep.play();
    
      sm = document.forms.Kasse.Rechnung.value.substring(0,len-2); 
 	  var lm = sm.lastIndexOf("\n"); 
      if (lm===-1) {
        reset_kasse();
	  } else {

        document.forms.Kasse.Rechnung.value = document.forms.Kasse.Rechnung.value.substring(0,lm+1);
		document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - bs_Value.pop();
        document.forms.Kasse.Einzel.value = bs_Value[bs_Value.length-1];
	    mulFaktor = bs_Faktor.pop();
		
	  }
	 } else {
      // nothing to delete
	  snd_boop.play();
	 }
	}
}
	
function sortiment_switch(z) {
 
 if (z=="") {
   snd_beep.play();
   sortimentIndex += 1;
   if (sortimentIndex>=Sortiment.length) {
     sortimentIndex = 0;
   } 
   showSortiment ();
 } 
 else {

  var
    i = Number(z);
	if ((i>0)&&(i<=Sortiment.length)) {

      snd_bleep.play();
	  sortimentIndex = i-1;
	  showSortiment();
      
      // das Eingabefeld leeren
      document.forms.Kasse.Eingabe.value = '';
	} else {
      // Code nicht gefunden
      snd_boop.play();    
      document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
	}
 }
}
 
function JSONRequest(data) {
 
    disableForm(true);
	
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState===4) {
	        if (xmlhttp.status===200) {
                r_add(xmlhttp.responseText);
	            if (xmlhttp.responseText.indexOf("ERROR")!==-1) {
	                snd_boop.play();
	            } 
				else { 
		            snd_bleep.play();
	            }
            } 
			else {
                snd_boop.play();    
	            r_add('ERROR ' + xmlhttp.status);
	        }
            disableForm(false);

		}
		
    }

	snd_beep.play();
 
    xmlhttp.open('POST', 'up.php5' , true);
    xmlhttp.setRequestHeader("Content-Type", "application/jsonrequest");
    var
        transport =  '{ Rechnung: "' + escape(data) + '" }';
    xmlhttp.setRequestHeader("Content-Length", transport.length);
    xmlhttp.setRequestHeader("Content-Encoding", "identity");
    xmlhttp.send(transport);
  
}
</script>
</head>
 <body onload="showSortiment()" bgcolor="#ffffff" text="#000000" link="#cc0000" vlink="#999999" alink="#ffcc00">
  <form name="Kasse" onsubmit="return false;" action="">
   <table>
    <tr>
    <td>
     <input class="sum" type="text" align="right" value="" name="Summe" size="6"/>
     <input class="sum" type="text" align=right value="" name="Einzel" size="6"/>
     <br>
     <textarea name="Rechnung" cols="22" rows="13"></textarea>
    </td>
    <td>
     <table>
      <TR>
       <TD align="center">
        <input class="sum" type="text" align="right" value="" name="Eingabe" size="10"/>
       </TD>
      </TR>
      <TR>
       <TD>
  <button type="button" name="bar"    OnClick="JSONRequest('BAR\n' + document.forms.Kasse.Rechnung.value); return false;">Bar</button>
  <button type="button" name="ec"     OnClick="JSONRequest('EC\n' + document.forms.Kasse.Rechnung.value); return false;">&nbsp;EC</button>
  <button type="button" name="storno" OnClick="reset_kasse()">&nbsp;C&nbsp;</button>
  <button type="button" name="clear"  OnClick="bs()">&nbsp;&larr;&nbsp;</button>
  <br>
  <button type="button" name="seven" OnClick="a('7')">&nbsp;7&nbsp;</button>
  <button type="button" name="eight" OnClick="a('8')">&nbsp;8&nbsp;</button>
  <button type="button" name="nine"  OnClick="a('9')">&nbsp;9&nbsp;</button>
  <button type="button" name="mul"   OnClick="r_mul(document.forms.Kasse.Eingabe.value)">&nbsp;*&nbsp;</button>
  <br>
  <button type="button" name="four"  OnClick="a('4')">&nbsp;4&nbsp;</button>
  <button type="button" name="five"  OnClick="a('5')">&nbsp;5&nbsp;</button>
  <button type="button" name="six"   OnClick="a('6')">&nbsp;6&nbsp;</button>
  <button type="button" name="minus" OnClick="r_minus(document.forms.Kasse.Eingabe.value)">&nbsp;-&nbsp;</button>
  <br>
  <button type="button" name="one"   OnClick="a('1')">&nbsp;1&nbsp;</button>
  <button type="button" name="two"   OnClick="a('2')">&nbsp;2&nbsp;</button>
  <button type="button" name="three" OnClick="a('3')">&nbsp;3&nbsp;</button>
  <button type="button" name="plus"  OnClick="r_plus(document.forms.Kasse.Eingabe.value)">&nbsp;+&nbsp;</button>
  <br>
  <button type="button" name="zero" OnClick="a('0')">&nbsp;0&nbsp;</button>
  <button type="button" disabled>&nbsp;&nbsp;&nbsp;</button>
  <button type="button" name="komma" OnClick="a(',')">&nbsp;,&nbsp;</button>
  <button type="button" name="sortiment"  OnClick="sortiment_switch(document.forms.Kasse.Eingabe.value)">Sor</button>
  <br>
      </TD>
     </TR>
     <TR>
      <TD>
        <input class="lst" type="text" disabled value="" name="Sortiment" size="25"/>
      </TD>
     </TR>
    </table>
   </td>
  </tr>
 </table>	
</form>
</body>
<!-- START DER ROHDATEN
$Datum=05.05.2015
$Datum10=05.05.2015
$Datum8=05.05.15
$Diagnose=I:\KundenUmgebung\DrBeichel\Diagnose\
$SEQ_TAGESABSCHLUSS=00001311
$SEQ_TAGWACHE=00001642
$Skript=Tagwache.Kasse-JavaScript
-->
<!-- START DER INCLUDES
I:\KundenUmgebung\DrBeichel\HTML Vorlagen\kasse.html
I:\KundenUmgebung\DrBeichel\HTML Vorlagen\..\OLAP\OLAP.tmp4.csv
-->
</html>
