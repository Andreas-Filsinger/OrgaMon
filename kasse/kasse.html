<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
          "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>OrgaMon Kasse Rev 1.021</title>
<style type="text/css">
<!--
 button {font-family:monospace; font-size:15pt; font-weight:bolder;}
 body {font-family:monospace; font-size:12pt; font-weight:bold;}
 .lst {font:12pt monospace; font-weight:bolder; vertical-align:bottom;}
 .sum {font:12pt monospace; font-weight:bolder; vertical-align:bottom; text-align:right; }
}
-->
</style>
<script type="text/javascript">

var 
 // Request - Object
 xmlhttp=new XMLHttpRequest();

 /*  
 // next 4 Lines are Generated by OrgaMon-OLAP "Kasse-JavaScript.OLAP.txt"
<!-- INCLUDE ..\OLAP\OLAP.tmp4.csv -->
 */

 // diese Angaben sind eigentlich Kundenspeziefisch
 sortimentIndex = 0;

function showSortiment () {
  var i = sortimentIndex + 1;
  document.forms.Kasse.Sortiment.value = "S" + i + ":" + Sortiment[sortimentIndex];
 }
 
function a (z) {
  
  // Farbe erste mal (wieder) "normal"
  document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";

  // Sortiment initialisieren, wenn nicht schon belegt
  if (document.forms.Kasse.Sortiment.value==="") {
    showSortiment ();  
  }
  
  // Eingabe einfach dazu
  document.forms.Kasse.Eingabe.value += z; 
}
 
function r_add (z) {

    // eine Zeile hinzufügen
    document.forms.Kasse.Rechnung.value += z + '\n';

    // das Ende der textarea sichtbar machen!
    document.forms.Kasse.Rechnung.scrollTop = document.forms.Kasse.Rechnung.scrollHeight;
 }
  
 function r_plus (z) {
   
  if (z=="") {
    r_add('Rep');
	document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + Number(document.forms.Kasse.Einzel.value);
  } else {
   var kommaPos = z.indexOf(",");
   if (kommaPos!==-1) {
    // direkte Preiseingabe  
    r_add(z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	var v = z + "00";
	v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
    document.forms.Kasse.Einzel.value = v;	
	document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + Number(v);

    // das Eingabefeld leeren
	document.forms.Kasse.Eingabe.value = '';
  
   } else {

   var Suchbegriff = Number(z);
   for (var i = 0; i < Code.length; i++) {
    if (Suchbegriff==Code[i]) {
    
	 // den ermittelten Preis anzeigen
     document.forms.Kasse.Einzel.value = Preis[i];	
	
	 // den ermittelnten Preis zu Saldo hinzufügen
	 document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + Number(Preis[i]);
     
     // auf den Rechnungsbeleg ausgeben
     r_add(z + ':' + Titel[i]);
	
     // das Eingabefeld leeren
	 document.forms.Kasse.Eingabe.value = '';
	
     return false;
    }
   }

    // Code nicht gefunden
    document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
   }
  }
 }

 function r_minus (z) {
  
  var kommaPos = z.indexOf(",");
  if (kommaPos!==-1) {
    // direkte Preiseingabe  
    r_add('-' + z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	var v = z + "00";
	v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
    document.forms.Kasse.Einzel.value = -v;	
	document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - Number(v);

    // das Eingabefeld leeren
	document.forms.Kasse.Eingabe.value = '';
  }
 }
 
 function reset_kasse () {
  
  var len = document.forms.Kasse.Rechnung.value.length;
  sortimentIndex = 0;
  document.forms.Kasse.Eingabe.value = "";
  document.forms.Kasse.Rechnung.value = "";
  showSortiment ();
  
  document.forms.Kasse.Einzel.value = "";
  document.forms.Kasse.Summe.value = "";

  if (len==0) {
   location.reload(true);
  }
  
  return false;
 }
  
 function bs () {

    var len = document.forms.Kasse.Eingabe.value.length;
	var sm = "";
	 
    if (len>0) {
	
     document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";
     document.forms.Kasse.Eingabe.value = document.forms.Kasse.Eingabe.value.substring(0,len-1);
	}
	else {

     len = document.forms.Kasse.Rechnung.value.length;
	 if (len>0) {
    
      sm = document.forms.Kasse.Rechnung.value.substring(0,len-2); 
 	  var lm = sm.lastIndexOf("\n"); 
      if (lm===-1) {  
        document.forms.Kasse.Rechnung.value = "";
        document.forms.Kasse.Summe.value = "";
        document.forms.Kasse.Einzel.value = ""; 
	  } else	 {
        document.forms.Kasse.Rechnung.value = document.forms.Kasse.Rechnung.value.substring(0,lm+1);
        document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - Number(document.forms.Kasse.Einzel.value);
        document.forms.Kasse.Einzel.value = "";
	  }
	 }
	}
}	

function sortiment_switch(z) {
 if (z=="") {
 sortimentIndex += 1;
 if (sortimentIndex>=Sortiment.length) {
  sortimentIndex = 0;
 } 
      showSortiment ();
	  
 }
 else {
   var
    i = Number(z);
	if ((i>0)&&(i<=Sortiment.length)) {
	  sortimentIndex = i-1;
	  showSortiment();
      
      // das Eingabefeld leeren
      document.forms.Kasse.Eingabe.value = '';
	} else {

      // Code nicht gefunden
      document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
	}
 }
}
 
 function JSONRequest(data) {
 
 xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState===4) {
	   if (xmlhttp.status===200) {
          r_add(xmlhttp.responseText);
       } else {
          r_add('ERROR ' + xmlhttp.status);
	   }
	  }
  }
 
  xmlhttp.open('POST', 'up.php5' , true);
  xmlhttp.setRequestHeader("Content-Type", "application/jsonrequest");

  var
   transport =  '{ Rechnung: "' + escape(data) + '" }';

  xmlhttp.setRequestHeader("Content-Length", transport.length);
  xmlhttp.setRequestHeader("Content-Encoding", "identity");

  xmlhttp.send(transport);
  
}
</script>

</head>
<body onload="showSortiment()" bgcolor="#ffffff" text="#000000" link="#cc0000" vlink="#999999" alink="#ffcc00">
<form name="Kasse" onsubmit="return false;" action="">
<table>
 <tr>
  <td>
   <input class="sum" type="text" align="right" value="" name="Summe" size="6"/>
   <input class="sum" type="text" align=right value="" name="Einzel" size="6"/>
   <br>
   <textarea name="Rechnung" cols="22" rows="13"></textarea>
  </td>
  <td>
 
   <table>
    <TR>
     <TD>
      <input class="sum" type="text" value="" name="Eingabe" size="6"/>&nbsp;
      <input class="lst" type="text" value="" name="Sortiment" size="15"/><br>
     </TD>
    </TR>
    <TR>
     <TD>
 <button type="button" name="bar"    OnClick="JSONRequest('BAR\n' + document.forms.Kasse.Rechnung.value); return false;">Bar</button>
 <button type="button" name="ec"     OnClick="JSONRequest('EC\n' + document.forms.Kasse.Rechnung.value); return false;">&nbsp;EC</button>
 <button type="button" name="storno" OnClick="reset_kasse()">&nbsp;C&nbsp;</button>
 <button type="button" name="clear"  OnClick="bs()">&nbsp;&larr;&nbsp;</button>
 <br>
 <button type="button" name="seven" OnClick="a('7')">&nbsp;7&nbsp;</button>
 <button type="button" name="eight" OnClick="a('8')">&nbsp;8&nbsp;</button>
 <button type="button" name="nine"  OnClick="a('9')">&nbsp;9&nbsp;</button>
 <button type="button" disabled>&nbsp;&nbsp;&nbsp;</button>
 <br>
 <button type="button" name="four"  OnClick="a('4')">&nbsp;4&nbsp;</button>
 <button type="button" name="five"  OnClick="a('5')">&nbsp;5&nbsp;</button>
 <button type="button" name="six"   OnClick="a('6')">&nbsp;6&nbsp;</button>
 <button type="button" name="minus" OnClick="r_minus(document.forms.Kasse.Eingabe.value)">&nbsp;-&nbsp;</button>
 <br>
 <button type="button" name="one"   OnClick="a('1')">&nbsp;1&nbsp;</button>
 <button type="button" name="two"   OnClick="a('2')">&nbsp;2&nbsp;</button>
 <button type="button" name="three" OnClick="a('3')">&nbsp;3&nbsp;</button>
 <button type="button" name="plus"  OnClick="r_plus(document.forms.Kasse.Eingabe.value)">&nbsp;+&nbsp;</button>
 <br>
 <button type="button" name="zero" OnClick="a('0')">&nbsp;0&nbsp;</button>
 <button type="button" disabled>&nbsp;&nbsp;&nbsp;</button>
 <button type="button" name="komma" OnClick="a(',')">&nbsp;,&nbsp;</button>
 <button type="button" name="sortiment"  OnClick="sortiment_switch(document.forms.Kasse.Eingabe.value)">Sor</button>
 <br>
</TD>
</TR>
</TABLE>
	</td>
</tr>
   </table>	
  </form>
 </body>
</html>
