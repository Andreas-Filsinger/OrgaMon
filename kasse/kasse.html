<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>OrgaMon Kasse Rev 1.026</title>
<style type="text/css">
<!--
 button {font-family:monospace; font-size:15pt; font-weight:bolder;}
 body {font-family:monospace; font-size:12pt; font-weight:bold;}
 .lst {font:12pt monospace; font-weight:bolder; vertical-align:bottom;}
 .sum {font:12pt monospace; font-weight:bolder; vertical-align:bottom; text-align:right; }
}
-->
</style>
<script type="text/javascript">
var 
 // Request - Object
 xmlhttp = new XMLHttpRequest();

 // Sound Objekte 
 snd_beep = new Audio("beep.mp3");  
 snd_bleep = new Audio("bleep.mp3");  
 snd_boop = new Audio("boop.mp3");
 
 // "zurück" Objekte, Löschhistorie
 bs_Faktor = new Array();  // bestimmt wieviele Zeilen bei einem "bs" gelöscht werden müssen
 bs_Value = new Array(); // bestimmt den Preis, der von der Gesamtsumme abgezogen werden muss
 
 // Kontext
 sortimentIndex = 0;
 mulFaktor = 1;
 
 /*  
 // next 4 Lines are Generated by OrgaMon-OLAP "Kasse-JavaScript.OLAP.txt"
<!-- INCLUDE ..\OLAP\OLAP.tmp4.csv -->
 */
 
function showSortiment () {
  var i = sortimentIndex + 1;
  document.forms.Kasse.Sortiment.value = "S" + i + ":" + Sortiment[sortimentIndex];
}

function disableForm(state){
 var elements = document.forms.Kasse.elements;
 for (var i = 0, len = elements.length; i < len; ++i) {
  if (elements[i].type=="button") {
   if (elements[i].name!=="") {
    if (elements[i].name!=="storno") {
     elements[i].disabled = state;
    }
   }	
  }
 }
}
 
function a (z) {
  
  snd_beep.play();
  
  // Farbe erste mal (wieder) "normal"
  document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";
  // Sortiment initialisieren, wenn nicht schon belegt
  if (document.forms.Kasse.Sortiment.value==="") {
    showSortiment ();  
  }
  
  // Eingabe einfach dazu
  document.forms.Kasse.Eingabe.value += z; 
}
 
function r_add (z) {

    // eine Zeile hinzufügen
    document.forms.Kasse.Rechnung.value += z + '\n';
    // das Ende der textarea sichtbar machen!
    document.forms.Kasse.Rechnung.scrollTop = document.forms.Kasse.Rechnung.scrollHeight;
}
  
function r_plus (z) {
   
  var betrag_cent = 0;
  
  if (z=="") {
    if (mulFaktor==1) {
      betrag_cent = Number(document.forms.Kasse.Einzel.value);
	  if (betrag_cent!=0) {
        snd_beep.play();
        r_add('Rep');
	    document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;
	    bs_Faktor.push(1);
	    bs_Value.push(betrag_cent);
      } else {
    	// einen leeren Betrag kann man nicht repetieren
        snd_boop.play();
	  }
	} else { 
      // Rep ist mit Faktor nicht kombinierbar
      snd_boop.play();
    }
	
  } else {
    var kommaPos = z.indexOf(",");
    if (kommaPos!==-1) {
      // direkte Preiseingabe  
      r_add(z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	  var v = z + "00";
	  v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
      document.forms.Kasse.Einzel.value = v;
	  betrag_cent = Number(v * mulFaktor);
	  document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;

      bs_Faktor.push(mulFaktor);
      bs_Value.push(betrag_cent);

      // reset Mul Faktor
      mulFaktor = 1;

      // das Eingabefeld leeren
	  document.forms.Kasse.Eingabe.value = '';
  
    } else {

      var Suchbegriff = Number(z);
      for (var i = 0; i < Code.length; i++) {
        if (Suchbegriff==Code[i]) {

          // Erfolg
          snd_bleep.play();    
	 
	      // den ermittelten Einzel-Preis anzeigen
          document.forms.Kasse.Einzel.value = Preis[i];	
	
	      // den ermittelnten Preis zu Saldo hinzufügen
	      betrag_cent = Number(Preis[i] * mulFaktor);
	      document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) + betrag_cent;

	      bs_Faktor.push(mulFaktor);
	      bs_Value.push(betrag_cent);

	      mulFaktor = 1;
     
          // auf den Rechnungsbeleg ausgeben
          r_add(z + ':' + Titel[i]);
	
          // das Eingabefeld leeren
	      document.forms.Kasse.Eingabe.value = '';
	
          return false;
        }
      }
      // Code nicht gefunden
      snd_boop.play();
      document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
    }
  }
}
 
function r_minus (z) {
  
  var kommaPos = z.indexOf(",");
  if (kommaPos!==-1) {

    snd_beep.play();
    // direkte Preiseingabe  
    r_add('-' + z + ':' + Sortiment[sortimentIndex]+" ("+(sortimentIndex+1)+")");
	var v = z + "00";
	v = v.substring(0,kommaPos) + v.substring(kommaPos+1,kommaPos+3);
    document.forms.Kasse.Einzel.value = -v;	
	document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - Number(v);
    // das Eingabefeld leeren
	document.forms.Kasse.Eingabe.value = '';
  }
}

function r_mul (z) {
  if (mulFaktor===1) {
   if (z!=="") {
      var kommaPos = z.indexOf(",");
      if (kommaPos!==-1) {
        var zz = z.substring(0, kommaPos) + '.' + z.substring(kommaPos + 1) ;
  	    mulFaktor = Number(zz);
      } 
      else { 
	    mulFaktor = Number(z);
      }
      if (isNaN(mulFaktor)) {
        snd_boop.play();
        mulFaktor = 1;
      } else {
        r_add(z + " mal ...");
        snd_beep.play();

	    bs_Faktor.push(mulFaktor);
	    bs_Value.push(0);
      }
      // das Eingabefeld leeren
      document.forms.Kasse.Eingabe.value = '';
    }
  } else {
    // ein anderer Faktor ist schon aktiv
    snd_boop.play();
  }
}
 
function reset_kasse () {

  disableForm(false);
  var len = document.forms.Kasse.Rechnung.value.length;
  sortimentIndex = 0;
  mulFaktor = 1;
  bs_Faktor = [];
  bs_Value = [];
  document.forms.Kasse.Eingabe.value = "";
  document.forms.Kasse.Rechnung.value = "";
  showSortiment ();
  
  document.forms.Kasse.Einzel.value = "";
  document.forms.Kasse.Summe.value = "";
  if (len==0) {
   location.reload(true);
  }
  
  return false;
}
  
function bs () {

    var len = document.forms.Kasse.Eingabe.value.length;
	var sm = "";
	 
    if (len>0) {
	   snd_beep.play();

     document.forms.Kasse.Eingabe.style.backgroundColor = "#FFFFFF";
     document.forms.Kasse.Eingabe.value = document.forms.Kasse.Eingabe.value.substring(0,len-1);
	}
	else {
     len = document.forms.Kasse.Rechnung.value.length;
	 if (len>0) {
   snd_beep.play();
    
      sm = document.forms.Kasse.Rechnung.value.substring(0,len-2); 
 	  var lm = sm.lastIndexOf("\n"); 
      if (lm===-1) {
        reset_kasse();
	  } else {

        document.forms.Kasse.Rechnung.value = document.forms.Kasse.Rechnung.value.substring(0,lm+1);
		document.forms.Kasse.Summe.value = Number(document.forms.Kasse.Summe.value) - bs_Value.pop();
        document.forms.Kasse.Einzel.value = bs_Value[bs_Value.length-1];
	    mulFaktor = bs_Faktor.pop();
		
	  }
	 } else {
      // nothing to delete
	  snd_boop.play();
	 }
	}
}
	
function sortiment_switch(z) {
 
 if (z=="") {
   snd_beep.play();
   sortimentIndex += 1;
   if (sortimentIndex>=Sortiment.length) {
     sortimentIndex = 0;
   } 
   showSortiment ();
 } 
 else {

  var
    i = Number(z);
	if ((i>0)&&(i<=Sortiment.length)) {

      snd_bleep.play();
	  sortimentIndex = i-1;
	  showSortiment();
      
      // das Eingabefeld leeren
      document.forms.Kasse.Eingabe.value = '';
	} else {
      // Code nicht gefunden
      snd_boop.play();    
      document.forms.Kasse.Eingabe.style.backgroundColor = "#FF9933";
	}
 }
}
 
function JSONRequest(data) {
 
    disableForm(true);
	
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState===4) {
	        if (xmlhttp.status===200) {
                r_add(xmlhttp.responseText);
	            if (xmlhttp.responseText.indexOf("ERROR")!==-1) {
	                snd_boop.play();
	            } 
				else { 
		            snd_bleep.play();
	            }
            } 
			else {
                snd_boop.play();    
	            r_add('ERROR ' + xmlhttp.status);
	        }
            disableForm(false);

		}
		
    }

	snd_beep.play();
 
    xmlhttp.open('POST', 'up.php5' , true);
    xmlhttp.setRequestHeader("Content-Type", "application/jsonrequest");
    var
        transport =  '{ Rechnung: "' + escape(data) + '" }';
    xmlhttp.setRequestHeader("Content-Length", transport.length);
    xmlhttp.setRequestHeader("Content-Encoding", "identity");
    xmlhttp.send(transport);
  
}
</script>
</head>
 <body onload="showSortiment()" bgcolor="#ffffff" text="#000000" link="#cc0000" vlink="#999999" alink="#ffcc00">
  <form name="Kasse" onsubmit="return false;" action="">
   <table>
    <tr>
    <td>
     <input class="sum" type="text" align="right" value="" name="Summe" size="6"/>
     <input class="sum" type="text" align=right value="" name="Einzel" size="6"/>
     <br>
     <textarea name="Rechnung" cols="22" rows="13"></textarea>
    </td>
    <td>
     <table>
      <TR>
       <TD align="center">
        <input class="sum" type="text" align="right" value="" name="Eingabe" size="10"/>
       </TD>
      </TR>
      <TR>
       <TD>
  <button type="button" name="bar"    OnClick="JSONRequest('BAR\n' + document.forms.Kasse.Rechnung.value); return false;">Bar</button>
  <button type="button" name="ec"     OnClick="JSONRequest('EC\n' + document.forms.Kasse.Rechnung.value); return false;">&nbsp;EC</button>
  <button type="button" name="storno" OnClick="reset_kasse()">&nbsp;C&nbsp;</button>
  <button type="button" name="clear"  OnClick="bs()">&nbsp;&larr;&nbsp;</button>
  <br>
  <button type="button" name="seven" OnClick="a('7')">&nbsp;7&nbsp;</button>
  <button type="button" name="eight" OnClick="a('8')">&nbsp;8&nbsp;</button>
  <button type="button" name="nine"  OnClick="a('9')">&nbsp;9&nbsp;</button>
  <button type="button" name="mul"   OnClick="r_mul(document.forms.Kasse.Eingabe.value)">&nbsp;*&nbsp;</button>
  <br>
  <button type="button" name="four"  OnClick="a('4')">&nbsp;4&nbsp;</button>
  <button type="button" name="five"  OnClick="a('5')">&nbsp;5&nbsp;</button>
  <button type="button" name="six"   OnClick="a('6')">&nbsp;6&nbsp;</button>
  <button type="button" name="minus" OnClick="r_minus(document.forms.Kasse.Eingabe.value)">&nbsp;-&nbsp;</button>
  <br>
  <button type="button" name="one"   OnClick="a('1')">&nbsp;1&nbsp;</button>
  <button type="button" name="two"   OnClick="a('2')">&nbsp;2&nbsp;</button>
  <button type="button" name="three" OnClick="a('3')">&nbsp;3&nbsp;</button>
  <button type="button" name="plus"  OnClick="r_plus(document.forms.Kasse.Eingabe.value)">&nbsp;+&nbsp;</button>
  <br>
  <button type="button" name="zero" OnClick="a('0')">&nbsp;0&nbsp;</button>
  <button type="button" disabled>&nbsp;&nbsp;&nbsp;</button>
  <button type="button" name="komma" OnClick="a(',')">&nbsp;,&nbsp;</button>
  <button type="button" name="sortiment"  OnClick="sortiment_switch(document.forms.Kasse.Eingabe.value)">Sor</button>
  <br>
      </TD>
     </TR>
     <TR>
      <TD>
        <input class="lst" type="text" disabled value="" name="Sortiment" size="25"/>
      </TD>
     </TR>
    </table>
   </td>
  </tr>
 </table>	
</form>
</body>
<!-- START DER ROHDATEN
$Datum=05.05.2015
$Datum10=05.05.2015
$Datum8=05.05.15
$Diagnose=I:\KundenUmgebung\DrBeichel\Diagnose\
$SEQ_TAGESABSCHLUSS=00001311
$SEQ_TAGWACHE=00001642
$Skript=Tagwache.Kasse-JavaScript
-->
<!-- START DER INCLUDES
I:\KundenUmgebung\DrBeichel\HTML Vorlagen\kasse.html
I:\KundenUmgebung\DrBeichel\HTML Vorlagen\..\OLAP\OLAP.tmp4.csv
-->
</html>
